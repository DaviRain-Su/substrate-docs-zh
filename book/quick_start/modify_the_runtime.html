<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>修改运行时 - Substra官方文档中文版</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../quick_start/index.html"><strong aria-hidden="true">1.</strong> 🔜快速开始</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../quick_start/substrate_at_a_glance.html"><strong aria-hidden="true">1.1.</strong> Substrate一览</a></li><li class="chapter-item expanded "><a href="../quick_start/start_a_node.html"><strong aria-hidden="true">1.2.</strong> 启动一个节点</a></li><li class="chapter-item expanded "><a href="../quick_start/explor_the_code.html"><strong aria-hidden="true">1.3.</strong> 探索代码</a></li><li class="chapter-item expanded "><a href="../quick_start/modify_the_runtime.html" class="active"><strong aria-hidden="true">1.4.</strong> 修改运行时</a></li></ol></li><li class="chapter-item expanded "><a href="../learn/index.html"><strong aria-hidden="true">2.</strong> 📑学习</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../learn/welcome_to_substrate.html"><strong aria-hidden="true">2.1.</strong> 欢迎来到substrate</a></li><li class="chapter-item expanded "><a href="../learn/blockchain_basics.html"><strong aria-hidden="true">2.2.</strong> 区块链基础知识</a></li><li class="chapter-item expanded "><a href="../learn/arhitecture_and_rust.html"><strong aria-hidden="true">2.3.</strong> 架构和Rust库</a></li><li class="chapter-item expanded "><a href="../learn/networks_and_nodes.html"><strong aria-hidden="true">2.4.</strong> 网络和节点</a></li><li class="chapter-item expanded "><a href="../learn/what_can_you_build.html"><strong aria-hidden="true">2.5.</strong> 你能建造什么</a></li><li class="chapter-item expanded "><a href="../learn/runtime_development.html"><strong aria-hidden="true">2.6.</strong> 运行时开发</a></li><li class="chapter-item expanded "><a href="../learn/transactions_and_block.html"><strong aria-hidden="true">2.7.</strong> 交易和区块链基础知识</a></li><li class="chapter-item expanded "><a href="../learn/transaction_lifecycle.html"><strong aria-hidden="true">2.8.</strong> 交易生命周期</a></li><li class="chapter-item expanded "><a href="../learn/state_transitions_and_storage.html"><strong aria-hidden="true">2.9.</strong> 状态转换和存储</a></li><li class="chapter-item expanded "><a href="../learn/accounts_addresses_and_keys.html"><strong aria-hidden="true">2.10.</strong> 账户、地址和密钥</a></li><li class="chapter-item expanded "><a href="../learn/rust_for_substrate.html"><strong aria-hidden="true">2.11.</strong> Rust for Substrate</a></li><li class="chapter-item expanded "><a href="../learn/offchain_operations.html"><strong aria-hidden="true">2.12.</strong> 链下操作</a></li><li class="chapter-item expanded "><a href="../learn/light_clients_in_substate.html"><strong aria-hidden="true">2.13.</strong> Substrate Connect中的轻客户端</a></li><li class="chapter-item expanded "><a href="../learn/substrate_connect.html"><strong aria-hidden="true">2.14.</strong> 密码学</a></li><li class="chapter-item expanded "><a href="../learn/cryptography_consensus.html"><strong aria-hidden="true">2.15.</strong> 共识</a></li><li class="chapter-item expanded "><a href="../learn/cross_consensus_messaging.html"><strong aria-hidden="true">2.16.</strong> 跨共识消息传递</a></li></ol></li><li class="chapter-item expanded "><a href="../install/index.html"><strong aria-hidden="true">3.</strong> 🤔️安装</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../install/rust_toolchain.html"><strong aria-hidden="true">3.1.</strong> Rust工具链</a></li><li class="chapter-item expanded "><a href="../install/linux.html"><strong aria-hidden="true">3.2.</strong> Linux</a></li><li class="chapter-item expanded "><a href="../install/macos.html"><strong aria-hidden="true">3.3.</strong> MacOS</a></li><li class="chapter-item expanded "><a href="../install/windows.html"><strong aria-hidden="true">3.4.</strong> Windows</a></li><li class="chapter-item expanded "><a href="../install/developer_tools.html"><strong aria-hidden="true">3.5.</strong> 开发者工具</a></li><li class="chapter-item expanded "><a href="../install/troubleshoot_rust_issues.html"><strong aria-hidden="true">3.6.</strong> 排查Rust问题</a></li></ol></li><li class="chapter-item expanded "><a href="../build/index.html"><strong aria-hidden="true">4.</strong> 😄建造</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../build/smart_contracts.html"><strong aria-hidden="true">4.1.</strong> 智能合约</a></li><li class="chapter-item expanded "><a href="../build/custom_pallets.html"><strong aria-hidden="true">4.2.</strong> 定制Pallet</a></li><li class="chapter-item expanded "><a href="../build/runtime_storage.html"><strong aria-hidden="true">4.3.</strong> 运行时存储</a></li><li class="chapter-item expanded "><a href="../build/transactions_weights_and_fee.html"><strong aria-hidden="true">4.4.</strong> 交易权重和费用</a></li><li class="chapter-item expanded "><a href="../build/pallet_coupling.html"><strong aria-hidden="true">4.5.</strong> Pallet coupling</a></li><li class="chapter-item expanded "><a href="../build/events_and_errors.html"><strong aria-hidden="true">4.6.</strong> 事件和错误</a></li><li class="chapter-item expanded "><a href="../build/randomness.html"><strong aria-hidden="true">4.7.</strong> 随机性</a></li><li class="chapter-item expanded "><a href="../build/privileged_calls_and_origins.html"><strong aria-hidden="true">4.8.</strong> 特权调用和Origin</a></li><li class="chapter-item expanded "><a href="../build/remote_procedure_calls.html"><strong aria-hidden="true">4.9.</strong> 远程过程调用</a></li><li class="chapter-item expanded "><a href="../build/application_development.html"><strong aria-hidden="true">4.10.</strong> 应用开发</a></li><li class="chapter-item expanded "><a href="../build/chain_specification.html"><strong aria-hidden="true">4.11.</strong> 链条规格</a></li><li class="chapter-item expanded "><a href="../build/genesis_configuration.html"><strong aria-hidden="true">4.12.</strong> 创世纪配置</a></li><li class="chapter-item expanded "><a href="../build/build_process.html"><strong aria-hidden="true">4.13.</strong> 构建过程</a></li><li class="chapter-item expanded "><a href="../build/build_a_deterministic_runtime.html"><strong aria-hidden="true">4.14.</strong> 构建确定性运行时</a></li><li class="chapter-item expanded "><a href="../build/troubleshoot_your_code.html"><strong aria-hidden="true">4.15.</strong> 对您的代码进行故障排除</a></li></ol></li><li class="chapter-item expanded "><a href="../test/index.html"><strong aria-hidden="true">5.</strong> ❌测试</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../test/unit_test.html"><strong aria-hidden="true">5.1.</strong> 单元测试</a></li><li class="chapter-item expanded "><a href="../test/debug.html"><strong aria-hidden="true">5.2.</strong> 调试</a></li><li class="chapter-item expanded "><a href="../test/benchmark.html"><strong aria-hidden="true">5.3.</strong> 基准</a></li><li class="chapter-item expanded "><a href="../test/simulate_parachains.html"><strong aria-hidden="true">5.4.</strong> 在测试网络中模拟平行链</a></li><li class="chapter-item expanded "><a href="../test/check_runtime.html"><strong aria-hidden="true">5.5.</strong> 检查运行时间</a></li></ol></li><li class="chapter-item expanded "><a href="../deploy/index.html"><strong aria-hidden="true">6.</strong> 🪤部署</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../deploy/prepare_to_deploy.html"><strong aria-hidden="true">6.1.</strong> 准备部署</a></li><li class="chapter-item expanded "><a href="../deploy/deployment_options.html"><strong aria-hidden="true">6.2.</strong> 部署选项和工具</a></li><li class="chapter-item expanded "><a href="../deploy/keys_and_network_operations.html"><strong aria-hidden="true">6.3.</strong> 密钥签名和网络操作</a></li></ol></li><li class="chapter-item expanded "><a href="../maintain/index.html"><strong aria-hidden="true">7.</strong> ⚠️维护</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../maintain/monitor.html"><strong aria-hidden="true">7.1.</strong> 监视器</a></li><li class="chapter-item expanded "><a href="../maintain/runtime_upgrades.html"><strong aria-hidden="true">7.2.</strong> 运行时升级</a></li></ol></li><li class="chapter-item expanded "><a href="../tutorials/index.html"><strong aria-hidden="true">8.</strong> 💾教程</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../tutorials/build_a_blockchain.html"><strong aria-hidden="true">8.1.</strong> 构建区块链</a></li><li class="chapter-item expanded "><a href="../tutorials/build_application_logic.html"><strong aria-hidden="true">8.2.</strong> 构建应用程序逻辑</a></li><li class="chapter-item expanded "><a href="../tutorials/build_a_parachain.html"><strong aria-hidden="true">8.3.</strong> 构建平行链</a></li></ol></li><li class="chapter-item expanded "><a href="../reference/index.html"><strong aria-hidden="true">9.</strong> 参考</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/rust_api.html"><strong aria-hidden="true">9.1.</strong> Rust API</a></li><li class="chapter-item expanded "><a href="../reference/glossary.html"><strong aria-hidden="true">9.2.</strong> 词汇表</a></li><li class="chapter-item expanded "><a href="../reference/command_line_tools.html"><strong aria-hidden="true">9.3.</strong> 命令行工具</a></li><li class="chapter-item expanded "><a href="../reference/runtime_apis.html"><strong aria-hidden="true">9.4.</strong> 运行时 API</a></li><li class="chapter-item expanded "><a href="../reference/frame_pallets.html"><strong aria-hidden="true">9.5.</strong> 框架托盘</a></li><li class="chapter-item expanded "><a href="../reference/frame_macors.html"><strong aria-hidden="true">9.6.</strong> 框架宏</a></li><li class="chapter-item expanded "><a href="../reference/account_data_structures.html"><strong aria-hidden="true">9.7.</strong> 帐户数据结构</a></li><li class="chapter-item expanded "><a href="../reference/type_encoding.html"><strong aria-hidden="true">9.8.</strong> 类型编码 (SCALE)</a></li><li class="chapter-item expanded "><a href="../reference/address_formats.html"><strong aria-hidden="true">9.9.</strong> 地址格式</a></li><li class="chapter-item expanded "><a href="../reference/transaction_fromats.html"><strong aria-hidden="true">9.10.</strong> 交易格式</a></li><li class="chapter-item expanded "><a href="../reference/xcm_reference.html"><strong aria-hidden="true">9.11.</strong> XCM参考</a></li><li class="chapter-item expanded "><a href="../reference/how_to_reference_guides.html"><strong aria-hidden="true">9.12.</strong> 操作方法快速参考指南</a></li></ol></li><li class="chapter-item expanded "><a href="../community/index.html"><strong aria-hidden="true">10.</strong> 🏠社区</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../community/content_style_guide.html"><strong aria-hidden="true">10.1.</strong> 内容风格指南</a></li><li class="chapter-item expanded "><a href="../community.contributor_guidelines.html"><strong aria-hidden="true">10.2.</strong> 贡献者指南</a></li><li class="chapter-item expanded "><a href="../community/template_how_to_guide.html"><strong aria-hidden="true">10.3.</strong> 模板 - 操作指南</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Substra官方文档中文版</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="修改运行时"><a class="header" href="#修改运行时">修改运行时</a></h1>
<p>在探索代码中，您了解了构成默认节点模板的清单文件和 Rust 模块。现在您对运行时源代码的外观有了大致的了解，让我们看看通过一些简单的更改来自定义运行时是多么容易。</p>
<p>对于这个简单的演示，您将执行以下操作：</p>
<ul>
<li>添加一个具有您要使用的某些功能的托盘。</li>
<li>更改一些常量值。</li>
<li>更新运行时版本。</li>
<li>重新编译运行时以包含您的更改。</li>
<li>提交交易以更新存储在链上的运行时。</li>
</ul>
<p>您还将看到另一个使用 Polkadot-JS API 的应用程序，以及如何使用该应用程序的托管版本来查看链状态和提交交易。</p>
<h2 id="在你开始之前"><a class="header" href="#在你开始之前">在你开始之前</a></h2>
<p>当您使用 --dev 命令行选项在开发模式下运行节点时，它会以干净的状态启动第一个块。为了最好地说明如何修改和更新运行时，您应该使用默认运行时重新启动默认节点模板，以便它开始生成块。</p>
<p>要使用默认运行时重新启动节点：</p>
<ol>
<li>在您的计算机上打开终端外壳。</li>
<li>切换到编译 Substrate 节点模板的根目录。</li>
<li>通过运行以下命令以开发模式启动本地节点：
<pre><code class="language-bash">cargo run --release -- --dev
</code></pre>
</li>
</ol>
<p>启动节点后，您可以使用使用 Polkadot-JS API 构建的基于浏览器的应用程序连接到它。</p>
<p>要连接到正在运行的节点：</p>
<p>1.在 Chrome 或基于 Chromium 的浏览器中打开 <a href="https://polkadot.js.org/apps/#/explorer">Polkadot/Substrate 门户</a>。 如果您使用限制性更强的浏览器——例如 Firefox——您可能会发现 Polkadot/Substrate 门户和节点之间的连接被阻止。</p>
<ol start="2">
<li>
<p>如有必要，连接到开发网络和默认本地节点端点 127.0.0.1:9944 。
在大多数情况下，<a href="https://polkadot.js.org/apps/#/explorer">Polkadot/Substrate Portal</a> 会自动初始化与正在运行的本地节点的连接。如果需要，单击 Unknown 以显示网络选择菜单，然后选择 Development 和 Local Node，然后单击 Switch。</p>
</li>
<li>
<p>请注意，在开发下，节点模板版本是默认版本 100。</p>
<p><img src="https://docs.substrate.io/static/c2fb81c66cb08d25c1a3d253bc4e339a/01a2d/quickstart-100.avif" alt="" /></p>
</li>
</ol>
<h2 id="添加托盘"><a class="header" href="#添加托盘">添加托盘</a></h2>
<p>开始使用 Substrate 和 FRAME 进行构建的最常见方法涉及添加 pallet，方法是从现有库中导入 pallet 或创建自己的 pallet。从头开始创建您自己的 pallet 并不困难，但它需要更多的工作来设计应用程序逻辑、存储要求、错误处理等。为了简单起见，让我们通过从现有库中导入一个托盘来添加一个托盘。</p>
<p>默认情况下，节点模板不包含 <a href="">Utility pallet</a>。如果此 pallet 包含您要使用的功能，您可以将其添加到默认运行时。</p>
<p>要添加实用程序托盘：</p>
<p>1.在您的计算机上打开第二个终端 shell 并切换到节点模板根目录。
2.在代码编辑器中打开运行时清单 — runtime/Cargo.toml 。
3. 找到 [dependencies] 部分并将 Utility pallet 添加为依赖项。
例如，您应该添加类似于以下内容的一行。</p>
<pre><code class="language-toml">pallet-utility = { version = &quot;4.0.0-dev&quot;, default-features = false, git = &quot;https://github.com/paritytech/substrate.git&quot;, branch = &quot;polkadot-vX.Y.Z&quot; }
</code></pre>
<p>请务必将 branch = &quot;polkadot-vX.Y.Z&quot; 替换为用于其他 pallet 的 Polkadot 分支。</p>
<p>您可以将任何现有托盘依赖项复制为模型，以确保 pallet-utility 依赖项的分支设置与所有其他托盘的分支设置相同。</p>
<ol start="4">
<li>找到 [features] 部分并将 Utility pallet 添加到标准二进制文件的默认功能列表中。</li>
</ol>
<p>例子：</p>
<pre><code class="language-toml">[features]
default = [&quot;std&quot;]
std = [
  ...
  &quot;pallet-utility/std&quot;,
  ...
]
</code></pre>
<p>您将了解更多有关在 <a href="">Rust 和 WebAssembly</a> 中为标准和 WebAssembly 二进制文件构建功能的信息。</p>
<ol start="5">
<li>保存更改并关闭 Cargo.toml 文件。</li>
<li>在代码编辑器中打开 runtime/src/lib.rs 文件。</li>
<li>为 Utility pallet 添加 Config trait 的实现。</li>
</ol>
<p>例子：</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl pallet_utility::Config for Runtime {
  type RuntimeEvent = RuntimeEvent;
  type RuntimeCall = RuntimeCall;
  type PalletsOrigin = OriginCaller;
  type WeightInfo = pallet_utility::weights::SubstrateWeight&lt;Runtime&gt;;
}
<span class="boring">}
</span></code></pre></pre>
<p>每个 pallet 都有一个 Config 特性来表示它需要的特定参数和类型。您可以随时查看 pallet 的 Rust 文档，以了解有关其配置要求的更多信息。例如，您可以查看 <a href="">pallet-utility</a> 的 Rust 文档。</p>
<ol start="8">
<li>在 construct_runtime! 宏中添加 Utility pallet。</li>
</ol>
<p>例子：</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>construct_runtime!(
 pub struct Runtime
 where
    Block = Block,
    NodeBlock = opaque::Block,
    UncheckedExtrinsic = UncheckedExtrinsic
 {
        System: frame_system,
        RandomnessCollectiveFlip: pallet_randomness_collective_flip,
        Timestamp: pallet_timestamp,
        Aura: pallet_aura,
        ...
        Utility: pallet_utility, // Add this line
        ...
 }

<span class="boring">}
</span></code></pre></pre>
<p>您可以了解有关 <code>construct_runtime</code> 宏如何在 <a href="">FRAME 宏</a>和<a href="">运行时</a>构造宏中工作的更多信息。</p>
<h2 id="更改常量值"><a class="header" href="#更改常量值">更改常量值</a></h2>
<p>默认情况下，节点模板中的 Balances pallet 定义了一个 EXISTENTIAL_DEPOSIT 常量。 EXISTENTIAL_DEPOSIT 代表一个账户必须被视为有效活跃账户的最低余额。默认情况下，常量被定义为值为 500 的 128 位无符号整数类型。为简单起见，您要将此常量的值从 500 更改为 1000。</p>
<ol>
<li>
<p>在代码编辑器中打开 runtime/src/lib.rs 文件。</p>
</li>
<li>
<p>找到 Balances pallet 的 EXISTENTIAL_DEPOSIT 。</p>
</li>
</ol>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// Existential deposit.
pub const EXISTENTIAL_DEPOSIT: u128 = 500;
<span class="boring">}
</span></code></pre></pre>
<ol start="3">
<li>更新 EXISTENTIAL_DEPOSIT 的值。</li>
</ol>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub const EXISTENTIAL_DEPOSIT: u128 = 1000 // Update this value.
<span class="boring">}
</span></code></pre></pre>
<h2 id="更新运行时版本"><a class="header" href="#更新运行时版本">更新运行时版本</a></h2>
<p>默认情况下，节点模板使用 spec_version 和值 100 标识 VERSION 常量中的默认运行时版本。要指示您已对默认运行时进行更改，您将更改 @2 # 从 100 到 101。</p>
<p>请注意，对于您在快速入门中对默认运行时所做的更改，并非严格要求更新 spec_version 。但是，通过更新版本，您可以看到执行无叉升级所涉及的基本步骤。</p>
<p>要更新运行时版本：</p>
<ol>
<li>
<p>在代码编辑器中打开 runtime/src/lib.rs 文件。</p>
</li>
<li>
<p>找到 runtime_version 宏。</p>
</li>
</ol>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[sp_version::runtime_version]
pub const VERSION: RuntimeVersion = RuntimeVersion {
    spec_name: create_runtime_str!(&quot;node-template&quot;),
    impl_name: create_runtime_str!(&quot;node-template&quot;),
    authoring_version: 1,
    spec_version: 100,
    impl_version: 1,
    apis: RUNTIME_API_VERSIONS,
    transaction_version: 1,
    state_version: 1,
};
<span class="boring">}
</span></code></pre></pre>
<ol start="3">
<li>更新 spec_version 以指定新的运行时版本。</li>
</ol>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>spec_version: 101,  // Change the spec_version from 100 to 101
<span class="boring">}
</span></code></pre></pre>
<ol start="4">
<li>保存更改并关闭 runtime/src/lib.rs 文件。</li>
</ol>
<p>此时，您已经修改了运行时代码并更改了版本信息。但是，正在运行的节点仍在使用先前编译的运行时版本。如果您仍然使用 <a href="">Polkadot/Substrate 门</a>户连接到正在运行的节点，您可以看到节点模板版本仍然是默认版本 100，余额常量 existentialDeposit 的<a href="">链状态</a>仍然是 500。</p>
<h3 id="重新编译运行时"><a class="header" href="#重新编译运行时">重新编译运行时</a></h3>
<p>在更新节点模板以使用修改后的运行时之前，您必须重新编译运行时</p>
<p>要重新编译运行时包：</p>
<ol>
<li>打开第二个终端 shell 并切换到编译节点模板的根目录。
2.通过运行以下命令重新编译运行时：</li>
</ol>
<pre><code class="language-bash">cargo build --release --package node-template-runtime
</code></pre>
<p>--release 命令行选项需要更长的编译时间。但是，它会生成一个更小的构建工件，更适合提交到区块链网络。存储优化对任何区块链都至关重要。使用此命令，构建工件将输出到 target/release 目录。 WebAssembly 构建工件位于 target/release/wbuild/node-template-runtime 目录中。例如，如果您列出 target/release/wbuild/node-template-runtime 目录的内容，您应该会看到以下 WebAssembly 工件：</p>
<pre><code class="language-bash">node_template_runtime.compact.compressed.wasm
node_template_runtime.compact.wasm
node_template_runtime.wasm
</code></pre>
<h2 id="提交交易"><a class="header" href="#提交交易">提交交易</a></h2>
<p>您现在有一个更新的 WebAssembly 对象，它描述了修改后的运行时。但是，正在运行的节点尚未使用升级后的运行时。要更新存储在链上的运行时，您必须提交一个更改要使用的 WebAssembly 对象的交易。</p>
<p>要更新运行时：</p>
<ol>
<li>在 Polkadot/Substrate 门户中，单击 Developer 并选择 Extrinsics。</li>
<li>选择管理 Alice 帐户。</li>
<li>选择 sudo pallet 和 sudoUncheckedWeight(call, weight) 函数。
4.选择 system 和 setCode(code) 作为使用 Alice 帐户进行的调用。</li>
<li>单击文件上传，然后选择或拖放您为更新的运行时生成的紧凑且压缩的 WebAssembly 文件 — node_template_runtime.compact.compressed.wasm 。</li>
</ol>
<p>例如，导航到 target/release/wbuild/node-template-runtime 目录并选择 node_template_runtime.compact.compressed.wasm 作为要上传的文件。</p>
<p>6.将两个权重参数设置为默认值 0 。</p>
<p><img src="https://docs.substrate.io/static/1abb15872875a741ba7957a77463480a/0f4c1/set-code-transaction.avif" alt="" /></p>
<ol start="7">
<li>单击提交交易。</li>
<li>查看授权，然后单击“签名并提交”。</li>
</ol>
<h2 id="验证修改后的运行时"><a class="header" href="#验证修改后的运行时">验证修改后的运行时</a></h2>
<p>事务包含在块中后，您可以验证您使用的是修改后的运行时。</p>
<p>要验证您的更改：</p>
<ol>
<li>在 <a href="">Polkadot/Substrate Portal</a> 中，点击 Network 并选择 Explorer 可以看到已经有一个成功的 sudo.Sudid 事件。</li>
</ol>
<p><img src="https://docs.substrate.io/static/acc82575c3cb918243bcb63731c7e2fd/ae6f6/set-code-sudo-event.avif" alt="" /></p>
<ol start="2">
<li>检查节点模板版本现在是 101 。</li>
</ol>
<p>例如：</p>
<p><img src="https://docs.substrate.io/static/d2b284ae84ff285bd030d91aa16f35b0/01a2d/quickstart-101.avif" alt="" /></p>
<ol start="3">
<li>
<p>单击 Developer 并选择 Extrinsics。</p>
</li>
<li>
<p>单击 submit the following extrinsic 并滚动到列表底部以验证实用工具托盘是否作为一个选项可用。</p>
</li>
</ol>
<p><img src="https://docs.substrate.io/static/b6d4b1158817952d65b3969e402f57a3/58d4a/quickstart-utility-pallet.avif" alt="" /></p>
<ol start="5">
<li>
<p>点击 Developer ，选择 Chain state，然后点击 <a href="https://polkadot.js.org/apps/#/chainstate/constants?rpc=ws://127.0.0.1:9944">Constants</a>。</p>
</li>
<li>
<p>选择balances pallet，选择existentialDeposit，然后点击+查询常量值。</p>
</li>
</ol>
<p><img src="https://docs.substrate.io/static/b0ccb722efcfbc95f68eefd19af972f0/0cdde/quickstart-chain-state.avif" alt="" /></p>
<h2 id="下一步去哪里"><a class="header" href="#下一步去哪里">下一步去哪里</a></h2>
<p>验证更改后，您知道您正在运行自定义版本的节点模板，并且已成功升级本地节点以使用修改后的运行时。</p>
<p>这是一项了不起的成就，但您还可以做更多的事情。要深入了解概念和核心组件，请查看“学习”部分中的主题，或者通过探索“构建”部分中的主题，开始构建您目前所学的内容。</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../quick_start/explor_the_code.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../learn/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../quick_start/explor_the_code.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../learn/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script type="text/javascript">
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
